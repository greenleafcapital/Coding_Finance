<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>How to download and clean Fama French 3 factor model data in R :: Coding Finance</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/post/2018-06-15-clean-ff-data-in-r/" />


<link rel="stylesheet" href="/assets/style.css">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/style.css">




<link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="img/favicon.png">


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="How to download and clean Fama French 3 factor model data in R :: Coding Finance — " />
<meta name="twitter:description" content="In the last post we learned to download the FF data. In this post we will learn to clean the data so we can use it for our analysis.
First lets load the libraries and the data.
library(tidyquant) library(timetk) ff_url &amp;lt;- &amp;quot;https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_Factors_CSV.zip&amp;quot; temp_file &amp;lt;- tempfile() download.file(ff_url, temp_file) ff_data_raw &amp;lt;- read_csv(unzip(temp_file), skip = 3) ## Warning: Missing column names filled in: &amp;#39;X1&amp;#39; [1] ## Parsed with column specification: ## cols( ## X1 = col_integer(), ## `Mkt-RF` = col_double(), ## SMB = col_double(), ## HML = col_double(), ## RF = col_double() ## ) ## Warning in rbind(names(probs), probs_f): number of columns of result is not ## a multiple of vector length (arg 1) ## Warning: 8 parsing failures." />
<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="/img/default.jpg">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="How to download and clean Fama French 3 factor model data in R :: Coding Finance — ">
<meta property="og:description" content="" />
<meta property="og:url" content="/post/2018-06-15-clean-ff-data-in-r/" />
<meta property="og:site_name" content="How to download and clean Fama French 3 factor model data in R" />
<meta property="og:image" content="/img/default.jpg">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-06-15 00:00:00 &#43;0000 UTC" />







</head>
<body>
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" style="text-decoration: none;">
  <div class="logo">
    
      <span class="logo__mark">></span>
      <span class="logo__text">coding finance</span>
      <span class="logo__cursor"></span>
    
  </div>
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner">
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/code">Code</a></li>
    
  </ul>
</nav>
        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>        
        </span>
      
      <span class="theme-toggle">
        <svg class="bulb-off" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="24" height="24"/>
  <path d="M4 19C4 19.55 4.45 20 5 20H9C9.55 20 10 19.55 10 19V18H4V19ZM7 0C3.14 0 0 3.14 0 7C0 9.38 1.19 11.47 3 12.74V15C3 15.55 3.45 16 4 16H10C10.55 16 11 15.55 11 15V12.74C12.81 11.47 14 9.38 14 7C14 3.14 10.86 0 7 0ZM9.85 11.1L9 11.7V14H5V11.7L4.15 11.1C2.8 10.16 2 8.63 2 7C2 4.24 4.24 2 7 2C9.76 2 12 4.24 12 7C12 8.63 11.2 10.16 9.85 11.1Z" transform="translate(5 2)" fill="black"/>
</svg>

<svg class="bulb-on" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="24" height="24"/>
  <path class="bulb-on__base" d="M4 19C4 19.55 4.45 20 5 20H9C9.55 20 10 19.55 10 19V18H4V19Z" transform="translate(5 2)" fill="#a9a9b3" />
  <path class="bulb-on__glass" d="M0 7C0 3.14 3.14 0 7 0C10.86 0 14 3.14 14 7C14 9.38 12.81 11.47 11 12.74V15C11 15.55 10.55 16 10 16H4C3.45 16 3 15.55 3 15V12.74C1.19 11.47 0 9.38 0 7Z" transform="translate(5 2)" fill="#a9a9b3" />
</svg>
  
      </span>
    </span>
  </span>
</header>


  <div class="content">
    
  <div class="post">
    <h2 class="post-title"><a href="/post/2018-06-15-clean-ff-data-in-r/">How to download and clean Fama French 3 factor model data in R</a></h2>
    <div class="post-meta">
      <span class="post-date">
        6/15/2019
      </span>
      <span class="post-author">Written by DD</span>
    </div>

    

    

    <div class="post-content">
      


<p>In the last post we learned to download the FF data. In this post we will learn to clean the data so we can use it for our analysis.</p>
<p>First lets load the libraries and the data.</p>
<pre class="r"><code>library(tidyquant)
library(timetk)</code></pre>
<pre class="r"><code>ff_url &lt;- &quot;https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_Factors_CSV.zip&quot;

temp_file &lt;- tempfile()

download.file(ff_url, temp_file)

ff_data_raw &lt;- read_csv(unzip(temp_file), skip = 3)</code></pre>
<pre><code>## Warning: Missing column names filled in: &#39;X1&#39; [1]</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   X1 = col_integer(),
##   `Mkt-RF` = col_double(),
##   SMB = col_double(),
##   HML = col_double(),
##   RF = col_double()
## )</code></pre>
<pre><code>## Warning in rbind(names(probs), probs_f): number of columns of result is not
## a multiple of vector length (arg 1)</code></pre>
<pre><code>## Warning: 8 parsing failures.
## row # A tibble: 5 x 5 col     row col    expected   actual                  file                     expected   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;                   &lt;chr&gt;                    actual 1  1115 X1     an integer Annual Factors: Januar~ &#39;./F-F_Research_Data_Fa~ file 2  1115 &lt;NA&gt;   5 columns  1 columns               &#39;./F-F_Research_Data_Fa~ row 3  1116 Mkt-RF a double   Mkt-RF                  &#39;./F-F_Research_Data_Fa~ col 4  1116 SMB    a double   SMB                     &#39;./F-F_Research_Data_Fa~ expected 5  1116 HML    a double   HML                     &#39;./F-F_Research_Data_Fa~
## ... ................. ... .......................................................................... ........ .......................................................................... ...... .......................................................................... .... .......................................................................... ... .......................................................................... ... .......................................................................... ........ ..........................................................................
## See problems(...) for more details.</code></pre>
<pre class="r"><code>head(ff_data_raw)</code></pre>
<pre><code>## # A tibble: 6 x 5
##       X1 `Mkt-RF`   SMB   HML    RF
##    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 192607     2.96 -2.3  -2.87  0.22
## 2 192608     2.64 -1.4   4.19  0.25
## 3 192609     0.36 -1.32  0.01  0.23
## 4 192610    -3.24  0.04  0.51  0.32
## 5 192611     2.53 -0.2  -0.35  0.31
## 6 192612     2.62 -0.04 -0.02  0.28</code></pre>
<p>Looking at the warning we can see that there was some issue with parsing row 1116. So lets check and delete unwanted data.</p>
<pre class="r"><code>ff_data_raw[c(1114:1118),]</code></pre>
<pre><code>## # A tibble: 5 x 5
##       X1 `Mkt-RF`    SMB    HML    RF
##    &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 201904     3.96  -1.69   1.99  0.21
## 2     NA    NA     NA     NA    NA   
## 3     NA    NA     NA     NA    NA   
## 4   1927    29.5   -2.46  -3.75  3.12
## 5   1928    35.4    4.2   -6.15  3.56</code></pre>
<p>The rows after, row 1114 is not needed, so we will delete that data.</p>
<pre class="r"><code>ff_data_raw &lt;- ff_data_raw[c(1:1114),]</code></pre>
<p>Now lets look at the data again.</p>
<pre class="r"><code>head(ff_data_raw)</code></pre>
<pre><code>## # A tibble: 6 x 5
##       X1 `Mkt-RF`   SMB   HML    RF
##    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 192607     2.96 -2.3  -2.87  0.22
## 2 192608     2.64 -1.4   4.19  0.25
## 3 192609     0.36 -1.32  0.01  0.23
## 4 192610    -3.24  0.04  0.51  0.32
## 5 192611     2.53 -0.2  -0.35  0.31
## 6 192612     2.62 -0.04 -0.02  0.28</code></pre>
<p>Lets change the column names.</p>
<pre class="r"><code>colnames(ff_data_raw) &lt;- paste(c(&#39;date&#39;, &quot;mkt_excess&quot;, &quot;smb&quot;, &quot;hml&quot;, &quot;rf&quot;))</code></pre>
<p>Now lets format the dates. Currently they are in the Year/month format and parsed as <code>int</code>. We want the format to be a full date, recognized by R for time series analysis.</p>
<pre class="r"><code>ff_data_raw %&gt;%
  mutate(date = ymd(parse_date(date, format = &quot;%Y%m&quot;)))</code></pre>
<pre><code>## # A tibble: 1,114 x 5
##    date       mkt_excess   smb   hml    rf
##    &lt;date&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1926-07-01       2.96 -2.3  -2.87  0.22
##  2 1926-08-01       2.64 -1.4   4.19  0.25
##  3 1926-09-01       0.36 -1.32  0.01  0.23
##  4 1926-10-01      -3.24  0.04  0.51  0.32
##  5 1926-11-01       2.53 -0.2  -0.35  0.31
##  6 1926-12-01       2.62 -0.04 -0.02  0.28
##  7 1927-01-01      -0.06 -0.56  4.83  0.25
##  8 1927-02-01       4.18 -0.1   3.17  0.26
##  9 1927-03-01       0.13 -1.6  -2.67  0.3 
## 10 1927-04-01       0.46  0.43  0.6   0.25
## # ... with 1,104 more rows</code></pre>
<p>But since FF release their data at the end of the month, we will change the date format to last day of each month.</p>
<pre class="r"><code>ff_data_raw %&gt;%
  mutate(date = ymd(parse_date(date, format = &quot;%Y%m&quot;))) %&gt;%
  mutate(date = rollback(date)) </code></pre>
<pre><code>## # A tibble: 1,114 x 5
##    date       mkt_excess   smb   hml    rf
##    &lt;date&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1926-06-30       2.96 -2.3  -2.87  0.22
##  2 1926-07-31       2.64 -1.4   4.19  0.25
##  3 1926-08-31       0.36 -1.32  0.01  0.23
##  4 1926-09-30      -3.24  0.04  0.51  0.32
##  5 1926-10-31       2.53 -0.2  -0.35  0.31
##  6 1926-11-30       2.62 -0.04 -0.02  0.28
##  7 1926-12-31      -0.06 -0.56  4.83  0.25
##  8 1927-01-31       4.18 -0.1   3.17  0.26
##  9 1927-02-28       0.13 -1.6  -2.67  0.3 
## 10 1927-03-31       0.46  0.43  0.6   0.25
## # ... with 1,104 more rows</code></pre>
<p>When we use the <code>rollback()</code> function, all dates get shift up 1 month. The big downside is, that our data is not aligned correctly. If we check the tail we lost April 2019 data. TO rectify this we can add one month to our data, before rolling it back.</p>
<pre class="r"><code>ff_data_raw &lt;- ff_data_raw %&gt;%
  mutate(date = ymd(parse_date(date, format = &quot;%Y%m&quot;))) %&gt;%
  mutate(date = date + months(1)) %&gt;% # Add one month
  mutate(date = rollback(date)) 

ff_data_raw</code></pre>
<pre><code>## # A tibble: 1,114 x 5
##    date       mkt_excess   smb   hml    rf
##    &lt;date&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1926-07-31       2.96 -2.3  -2.87  0.22
##  2 1926-08-31       2.64 -1.4   4.19  0.25
##  3 1926-09-30       0.36 -1.32  0.01  0.23
##  4 1926-10-31      -3.24  0.04  0.51  0.32
##  5 1926-11-30       2.53 -0.2  -0.35  0.31
##  6 1926-12-31       2.62 -0.04 -0.02  0.28
##  7 1927-01-31      -0.06 -0.56  4.83  0.25
##  8 1927-02-28       4.18 -0.1   3.17  0.26
##  9 1927-03-31       0.13 -1.6  -2.67  0.3 
## 10 1927-04-30       0.46  0.43  0.6   0.25
## # ... with 1,104 more rows</code></pre>
<p>We are almost done cleaning, we need to convert the data into decimal form. We will use a quick apply function to do that. We will want to skip the date column for that.</p>
<pre class="r"><code>ff_data_raw &lt;- ff_data_raw %&gt;%
  mutate_at(vars(-date), function(x) x/100)

ff_data_raw</code></pre>
<pre><code>## # A tibble: 1,114 x 5
##    date       mkt_excess     smb      hml     rf
##    &lt;date&gt;          &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 1926-07-31   0.0296   -0.023  -0.0287  0.0022
##  2 1926-08-31   0.0264   -0.0140  0.0419  0.0025
##  3 1926-09-30   0.0036   -0.0132  0.0001  0.0023
##  4 1926-10-31  -0.0324    0.0004  0.0051  0.0032
##  5 1926-11-30   0.0253   -0.002  -0.00350 0.0031
##  6 1926-12-31   0.0262   -0.0004 -0.0002  0.0028
##  7 1927-01-31  -0.000600 -0.0056  0.0483  0.0025
##  8 1927-02-28   0.0418   -0.001   0.0317  0.0026
##  9 1927-03-31   0.0013   -0.016  -0.0267  0.003 
## 10 1927-04-30   0.0046    0.0043  0.006   0.0025
## # ... with 1,104 more rows</code></pre>
<p>That’s it, our Fama French factor data is ready for analysis. Next we will load our portfolio data and do some analysis. We will repeat this process again in Python next.</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <a class="btn next" href="/post/2018-06-15-clean-ff-data-in-py/">← How to download and clean Fama French 3 factor model data in Python</a>
          
          
            <a class="btn previous" href="/post/2018-06-10-download-ff-data-in-py/">How to download Fama French 3 factor Model data in Python →</a>
           
        </div>
      </div>
    
  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" style="text-decoration: none;">
  <div class="logo">
    
      <span class="logo__mark">></span>
      <span class="logo__text">coding finance</span>
      <span class="logo__cursor"></span>
    
  </div>
</a>
      
    
  </div>
</footer>


  <script src="/assets/main.js"></script>

  <script src="/assets/prism.js"></script>



  
</div>

</body>
</html>
